<!DOCTYPE html>
<html>
  <head>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/people_style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Arvo&display=swap" rel="stylesheet">
  </head>
  <body>
    <h2 class="">Research Area</h2>
    
    <form onsubmit="submitForm(event)">

    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required placeholder="Enter your name">

    <label for="img">Upload Image:</label>
    <label for="file-upload" class="custom-file-upload">Choose File</label>
    <input id="file-upload" type="file" required>
    <span id="file-name" style="margin-top: 8px; font-size: 14px; color: #333;"></span>
     
     <label for="text">Description:</label>
    <!-- Formatter -->
        <div class="formatter">
          <div id="toolbar">
              <select class="ql-header">
                <option value="1"></option>
                <option value="2"></option>
                <option selected></option>
              </select>
              <button class="ql-bold"></button>
              <button class="ql-italic"></button>
              <button class="ql-underline"></button>
              <button class="ql-link"></button>
              <button class="ql-list" value="ordered"></button>
              <button class="ql-list" value="bullet"></button>
              <!-- Color pickers -->
              <select class="ql-color"></select>
              <select class="ql-background"></select>
              
              <button class="ql-clean"></button>
            </div>
            <!-- Editor (div) -->
            <div id="editor" style="height: 150px;"></div>
            <textarea name="description" id="hiddenArea" style="display:none;"></textarea>
            <button type="submit">Submit</button>
          </div>
        </form>
        
        
        <!-- Quill Script -->
        <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
        <!-- <script src="/js/quill.js"></script> -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.min.js"
        integrity="sha384-RuyvpeZCxMJCqVUGFI0Do1mQrods/hhxYlcVfGPOfQtPJh0JCw12tUAZ/Mv10S7D"
        crossorigin="anonymous"></script>

        <!-- JavaScript -->
        <script>
          const quill = new Quill('#editor', {
            theme: 'snow',
            modules: { toolbar: '#toolbar' }
            });

  async function submitForm(e) {
    e.preventDefault();

    const name = document.getElementById('name').value;
    const file = document.getElementById('file-upload').files[0];
    const description = quill.root.innerHTML;

    if (!file) {
      alert("Please upload an image.");
      return;
    }

    try {
      // 1. Get the upload URL
      const token = localStorage.getItem("authToken"); // assuming you're using token auth
      const uploadRes = await fetch('https://next-generation-adaptive-system-lab-nasl.onrender.com/api/image/uploadURL', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ imageName: file.name })
      });

      const res = await uploadRes.json();
      const data = res.data;

      console.log(data);
      const{ imageUploadingUrl , imageUrl } = data;
      // console.log(imageUploadingUrl);
      // console.log(imageUrl);
      // 2. Upload the image to the upload URL
      await fetch(imageUploadingUrl, {
        method: 'PUT',
        headers: {
          'Content-Type': file.type
        },
        body: file
      });

      console.log("Form Data:", { name, description, imageUrl });

      // 3. Submit the research area
      const response = await fetch('https://next-generation-adaptive-system-lab-nasl.onrender.com/api/researchArea/createReasearchArea', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name: name,
          description: description,
          imageURL: imageUrl
        })
      });

      const result = await response.json();

      if (response.ok) {
        alert("Research area created successfully!");
        // Reset form if needed
      } else {
        alert(result.message || "Failed to create research area");
      }

    } catch (err) {
      console.error("Error:", err);
      alert("Something went wrong!");
    }
  }
</script>

  </body>
</html>
